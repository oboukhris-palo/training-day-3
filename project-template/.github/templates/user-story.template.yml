# User Story Template - Jira-Compatible Schema
# This template follows Atlassian Jira's User Story model for seamless integration via MCP

metadata:
  # Unique identifier for the user story in the system
  issueId: ""
  
  # Project key (e.g., "PROJ")
  projectKey: ""
  
  # Story key (auto-generated by Jira, e.g., "PROJ-456")
  issueKey: ""
  
  # Issue type (always "Story" for user stories)
  issueType: "Story"

basic_info:
  # Story summary/title (required)
  summary: ""
  
  # Detailed description
  description: ""
  
  # Epic link (required - links story to parent epic)
  epicLink: ""
  epicKey: ""
  
  # Status
  status: "To Do"  # Allowed: To Do, In Progress, In Review, In Testing, Done
  
  # Resolution
  resolution: ""  # Fixed, Won't Fix, Duplicate, Cannot Reproduce, Done, etc.

user_story_format:
  # As a [user type]
  asA: ""
  
  # I want to [action/goal]
  iWantTo: ""
  
  # So that [business value/benefit]
  soThat: ""

acceptance_criteria:
  # List of acceptance criteria (definition of done)
  # Source: Product Owner validated requirements
  criteria:
    - ""
    # Example:
    # - "User can successfully log in with valid credentials"
    # - "Error message displays for invalid credentials"
    # - "Session persists for 24 hours"
  
  # PO validation status
  poValidated: false
  poValidatedBy: ""
  poValidationDate: ""
  poNotes: ""

bdd_scenarios:
  # Gherkin-formatted BDD scenarios (acceptance tests)
  # Used by QA and automation teams
  description: |
    # Feature: [Feature Name]
    # Description of the feature
    
    ## Scenario 1: [Scenario Title]
    Given [initial context]
    When [user action]
    Then [expected outcome]
    And [additional assertion]
    
    ## Scenario 2: [Alternative Path]
    Given [initial context]
    When [alternative action]
    Then [expected outcome]
  
  # Location of feature file (if exists)
  featureFileLocation: ""
  
  # Number of scenarios
  scenarioCount: 0
  
  # Current BDD test status
  bddTestsPassing: 0
  bddTestsTotal: 0
  bddTestsPassingPercentage: 0

ui_ux_inputs:
  # Form fields and interactions (if applicable)
  formFields:
    - name: ""
      type: "text"  # text, email, password, checkbox, select, etc.
      required: false
      validation: ""
      placeholder: ""
    # Example:
    # - name: "email"
    #   type: "email"
    #   required: true
    #   validation: "must be valid email"
    #   placeholder: "user@example.com"
  
  # UI components involved (from design system)
  components:
    - componentName: ""
      designTokens: []
      variant: ""
    # Example:
    # - componentName: "Button"
    #   designTokens: ["primary-color", "padding-md"]
    #   variant: "primary"
  
  # Responsive requirements
  responsiveRequirements:
    - "Mobile (320px+)"
    - "Tablet (768px+)"
    - "Desktop (1024px+)"
  
  # Accessibility requirements
  a11yRequirements:
    - "WCAG 2.1 Level AA"
    - "Keyboard navigation support"
    - "Screen reader compatible"
  
  # Design token requirements
  designTokens:
    - tokenName: ""
      value: ""
    # Example:
    # - tokenName: "primary-color"
    #   value: "#007AFF"
  
  # UX designer notes
  uxDesignerNotes: ""
  
  # Figma/Design file link
  designFileLink: ""

api_contracts:
  # REST endpoint specifications (if backend story)
  endpoints:
    - method: "GET"  # GET, POST, PUT, PATCH, DELETE
      path: ""
      description: ""
      requestSchema: ""
      responseSchema: ""
      statusCodes:
        - code: 200
          description: "Success"
        - code: 400
          description: "Bad Request"
        - code: 401
          description: "Unauthorized"
      authRequired: true
      rateLimit: ""
    # Example:
    # - method: "POST"
    #   path: "/api/v1/auth/login"
    #   description: "User login endpoint"
    #   requestSchema: '{"email": "string", "password": "string"}'
    #   responseSchema: '{"token": "string", "user": {...}}'
  
  # Database schema changes (if applicable)
  databaseChanges:
    - changeType: "CREATE TABLE"  # CREATE TABLE, ALTER TABLE, ADD COLUMN, etc.
      tableName: ""
      columns:
        - name: ""
          type: ""
          constraints: ""
        # Example:
        # - name: "user_id"
        #   type: "UUID"
        #   constraints: "PRIMARY KEY"
  
  # Integration points with other services
  integrations:
    - serviceName: ""
      endpoint: ""
      method: "API call"  # API call, Message Queue, Event, etc.
      frequency: ""
    # Example:
    # - serviceName: "Email Service"
    #   endpoint: "/send-email"
    #   method: "API call"
    #   frequency: "On user registration"
  
  # Data format standards
  dataFormats:
    - format: "JSON"
    - format: "ISO 8601"  # Date/time format
  
  # Security/encryption requirements
  securityRequirements:
    - requirement: ""
    # Example:
    # - requirement: "Passwords must be hashed with bcrypt"
    # - requirement: "API calls require OAuth2 bearer token"

implementation_notes:
  # Notes for developers (context, gotchas, etc.)
  developerNotes: ""
  
  # Layer-by-layer hints (provided by Dev-Lead)
  # Detailed breakdown is in implementation-plan.md
  layerHints:
    database: "Overview of DB changes"
    backend: "Overview of API/service changes"
    config: "Overview of config/routing changes"
    frontend: "Overview of UI component changes"
  
  # Known constraints or limitations
  constraints:
    - ""
  
  # Recommended reading/resources
  references:
    - title: ""
      url: ""
      type: "Documentation"  # Documentation, Blog, Code Example, etc.

details:
  # Story type (subtask of epic)
  storyType: "User Story"  # Allowed: User Story, Technical Story, Bug, Task
  
  # Priority level
  priority: "Medium"  # Allowed: Lowest, Low, Medium, High, Highest
  
  # Risk assessment
  risk: "Low"  # Allowed: Low, Medium, High
  
  # Story Status Category
  statusCategory: "To Do"  # Allowed: To Do, In Progress, Done
  
  # Start and end dates
  startDate: ""  # Format: YYYY-MM-DD
  dueDate: ""    # Format: YYYY-MM-DD
  targetDate: "" # Format: YYYY-MM-DD

team:
  # Assignee (developer who will work on the story)
  assignee:
    name: ""
    email: ""
    key: ""
  
  # Reporter/Creator
  reporter:
    name: ""
    email: ""
    key: ""
  
  # QA assignee (for testing)
  qaAssignee:
    name: ""
    email: ""
    key: ""
  
  # Design assignee
  designAssignee:
    name: ""
    email: ""
    key: ""

labels:
  # Labels for categorization and filtering
  labels: []
  # Example:
  # - frontend
  # - authentication
  # - urgent
  # - enhancement

components:
  # Software components affected
  components: []
  # Example:
  # - name: "Login Module"
  #   key: "LOGIN"
  # - name: "User Management"
  #   key: "USR_MGMT"

estimation:
  # Story points (effort estimation)
  storyPoints: 0
  
  # Time estimate (in hours)
  timeEstimate: 0
  
  # Original estimate
  originalEstimate: 0
  
  # Time spent (tracked during execution)
  timeSpent: 0
  
  # Remaining estimate
  remainingEstimate: 0

technical_details:
  # Technical specifications
  technicalNotes: ""
  
  # Acceptance test criteria (technical)
  technicalAcceptanceCriteria:
    - ""
  
  # Code review requirements
  codeReviewRequired: true
  
  # Security considerations
  securityConsiderations:
    - ""
  
  # Performance requirements
  performanceRequirements:
    - ""
  
  # Browser/platform compatibility
  compatibility:
    - ""

design_requirements:
  # UI/UX design references
  designDocuments:
    - title: ""
      url: ""
      type: "Figma"  # Figma, Sketch, Adobe XD, Wireframe, Mockup
  
  # Design review required
  designReviewRequired: false
  
  # UI elements involved
  uiElements:
    - ""
  
  # Accessibility requirements
  accessibilityRequirements:
    - "WCAG 2.1 Level AA compliance"

testing:
  # Test cases
  testCases:
    - id: ""
      description: ""
      expectedResult: ""
      priority: "High"  # High, Medium, Low
  
  # Test coverage requirement (percentage)
  testCoverageRequired: 80
  
  # QA notes
  qaNotesRequired: true
  
  # UAT (User Acceptance Testing) required
  uatRequired: false

dependencies:
  # Parent issue
  parentIssueKey: ""
  
  # Blocked by issues
  blockedBy: []
  # Example:
  # - key: "PROJ-100"
  #   summary: "Database schema migration"
  
  # Blocks issues
  blocks: []
  
  # Related issues
  relatedIssues: []
  # Example:
  # - key: "PROJ-200"
  #   linkType: "relates to"
  #   summary: "User profile enhancement"
  
  # External dependencies
  externalDependencies: []

risks_and_mitigations:
  risks:
    - risk: ""
      probability: "Low"  # Low, Medium, High
      impact: "Low"       # Low, Medium, High
      mitigation: ""

goals:
  # Success metrics
  successMetrics:
    - ""
  
  # Assumptions
  assumptions:
    - ""
  
  # Out of scope
  outOfScope:
    - ""

environment:
  # Environments where changes will be deployed
  environments:
    - development
    - staging
    - production
  
  # Deployment requirements
  deploymentNotes: ""
  
  # Database migrations required
  databaseMigrationsRequired: false
  
  # Configuration changes required
  configurationChangesRequired: false
  
  # Rollback plan
  rollbackRequired: false
  rollbackStrategy: ""

documentation:
  # Design documents
  designDocuments:
    - title: ""
      url: ""
  
  # Technical specifications
  technicalSpecs:
    - title: ""
      url: ""
  
  # API documentation
  apiDocumentation:
    - title: ""
      url: ""
  
  # Related wiki pages
  wikis:
    - title: ""
      url: ""

versioning:
  # Affected versions
  affectedVersions: []
  
  # Fix versions
  fixVersions: []
  
  # Target release
  targetRelease: ""

timeline:
  # Created and updated timestamps
  createdAt: ""  # Format: ISO 8601
  updatedAt: ""  # Format: ISO 8601
  
  # Sprint information
  sprint:
    name: ""
    startDate: ""
    endDate: ""
    sprintNumber: 0
  
  # Comments/activity
  comments:
    - author: ""
      timestamp: ""
      text: ""
  
  # Changelog entries
  changelog: []
  # Example:
  # - timestamp: "2025-01-01T10:00:00Z"
  #   author: "john.doe"
  #   field: "status"
  #   fromValue: "To Do"
  #   toValue: "In Progress"

workflow:
  # Current status workflow
  statusWorkflow: "Standard"
  
  # Transition history
  transitions: []
  # Example:
  # - from: "To Do"
  #   to: "In Progress"
  #   timestamp: "2025-01-02T10:00:00Z"
  #   author: "john.doe"
  
  # Approval workflow
  approvalsRequired: false
  approvals:
    - role: "Product Owner"
      approved: false
      approvedBy: ""
      approvalDate: ""
    - role: "Tech Lead"
      approved: false
      approvedBy: ""
      approvalDate: ""

attachments:
  # Files attached to the story
  attachments:
    - title: ""
      type: ""  # Document, Image, Video, Code, etc.
      url: ""
      uploadedBy: ""
      uploadedDate: ""

custom_fields:
  # Custom Jira fields (expand as needed for your instance)
  customField1: ""
  customField2: ""
  customField3: ""
  
  # Add your organization's specific custom fields here
  # Examples:
  # customerImpact: ""
  # businessValue: ""
  # complexity: ""

quality_metrics:
  # Code quality requirements
  codeQualityGate: "Required"
  
  # Bug count (if this is fixing bugs)
  bugsFixed: 0
  
  # Performance impact
  performanceImpact: "None"  # None, Positive, Negative, Unknown
  
  # Test execution status
  testExecutionStatus: ""
  
  # Defect density target
  defectDensityTarget: 0

watchers:
  # Users watching this story
  watchers:
    - name: ""
      email: ""

definition_of_ready:
  # DOR Checklist - Story must meet these before dev work starts
  checklist:
    - item: "PO has validated all acceptance criteria"
      completed: false
      validatedBy: ""
    - item: "BDD scenarios are clearly defined (Given-When-Then)"
      completed: false
      validatedBy: ""
    - item: "UI/UX requirements are documented with design references"
      completed: false
      validatedBy: ""
    - item: "API contract is documented (endpoints, schemas, status codes)"
      completed: false
      validatedBy: ""
    - item: "Database schema changes are identified"
      completed: false
      validatedBy: ""
    - item: "Acceptance criteria are measurable and unambiguous"
      completed: false
      validatedBy: ""
    - item: "Dependencies and blockers are identified"
      completed: false
      validatedBy: ""
    - item: "Story points have been estimated"
      completed: false
      validatedBy: ""
  
  # Overall DOR status
  dorMet: false
  dorValidatedBy: ""
  dorValidationDate: ""
  dorComments: ""

definition_of_done:
  # DOD Checklist - Story is complete only when these are done
  checklist:
    - item: "All acceptance criteria verified and passing"
      completed: false
      verifiedBy: ""
    - item: "All BDD scenarios passing (green tests)"
      completed: false
      verifiedBy: ""
    - item: "Code review approved (3-point checklist passed)"
      completed: false
      verifiedBy: ""
    - item: "Test coverage >= 80%"
      completed: false
      verifiedBy: ""
    - item: "No critical security issues"
      completed: false
      verifiedBy: ""
    - item: "Performance requirements met"
      completed: false
      verifiedBy: ""
    - item: "Design system compliance verified"
      completed: false
      verifiedBy: ""
    - item: "Documentation updated (README, inline comments)"
      completed: false
      verifiedBy: ""
    - item: "QA signed off"
      completed: false
      verifiedBy: ""
    - item: "Merge to main branch approved"
      completed: false
      verifiedBy: ""
  
  # Overall DOD status
  dodMet: false
  dodValidatedBy: ""
  dodValidationDate: ""
  dodComments: ""

enrichment_metadata:
  # Enrichment tracking (for BA agent workflow)
  enrichmentStatus: "Not Started"  # Not Started, In Progress, Ready for Dev, Enriched
  enrichmentPhase:
    importedFromPRD: false
    importedDate: ""
    poValidated: false
    poValidatedDate: ""
    bddExtracted: false
    bddExtractedDate: ""
    uxIntegrated: false
    uxIntegratedDate: ""
    apiContractDefined: false
    apiContractDate: ""
    dorValidated: false
    dorValidatedDate: ""
  
  # Implementation tracking (updated as story progresses)
  implementationStatus: "Not Started"  # Not Started, In Progress, In Review, Implemented, Delivered
  implementationPhase: ""  # Database, Backend, Config, Frontend, Complete
  
  # TDD execution tracking
  tddProgress:
    redPhase: false
    greenPhase: false
    refactorPhase: false
    allTestsPassing: false
  
  # Enrichment notes from BA agent
  baEnrichmentNotes: ""
  
  # Dev-Lead planning notes (from implementation-plan.md)
  devLeadNotes: ""
  
  # Last updated timestamp
  lastUpdated: ""
  lastUpdatedBy: ""
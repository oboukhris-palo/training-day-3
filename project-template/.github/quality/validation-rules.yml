# Quality Validation Rules Configuration
# This file defines quality gates, thresholds, and validation rules for automatic enforcement

quality_gates:
  
  # ====================================================================
  # DOCUMENT QUALITY GATES (PDLC Documents)
  # ====================================================================
  
  documents:
    
    # Project Management Documents (PM Agent)
    project_charter:
      agent: pm
      minimum_score: 85
      escalation_threshold: 60
      required_sections:
        - business_objectives
        - timeline_options
        - budget_allocation
        - risk_register
        - stakeholder_map
      validation_rules:
        - no_placeholder_text
        - quantified_objectives
        - timeline_has_dates
        - budget_has_numbers
        - stakeholders_identified
        
    sprint_plan:
      agent: pm
      minimum_score: 80
      escalation_threshold: 60
      required_sections:
        - sprint_goal
        - user_stories_selected
        - capacity_planning
        - sprint_backlog
        - definition_of_done
      validation_rules:
        - story_points_calculated
        - velocity_considered
        - risks_identified
        - team_capacity_realistic
        
    risk_assessment:
      agent: pm
      minimum_score: 90
      escalation_threshold: 70
      required_sections:
        - risk_identification
        - probability_impact_matrix
        - mitigation_strategies
        - contingency_plans
      validation_rules:
        - risks_quantified
        - mitigation_actionable
        - owners_assigned
        - timeline_realistic
    
    # Product Owner Documents (PO Agent)
    requirements:
      agent: po  
      minimum_score: 85
      escalation_threshold: 65
      required_sections:
        - functional_requirements
        - non_functional_requirements
        - constraints
        - assumptions
        - glossary
      validation_rules:
        - moscow_prioritization
        - measurable_criteria
        - requirement_ids_unique
        - acceptance_criteria_clear
        - nfr_quantified
        
    user_stories:
      agent: po
      minimum_score: 90
      escalation_threshold: 70
      required_sections:
        - epics
        - user_stories
        - acceptance_criteria
        - story_mapping
      validation_rules:
        - given_when_then_format
        - story_ids_unique
        - epic_references_valid
        - acceptance_criteria_measurable
        - story_points_estimated
        - personas_referenced
        
    # Business Analyst Documents (BA Agent)
    personas:
      agent: ba
      minimum_score: 85
      escalation_threshold: 65
      required_sections:
        - persona_profiles
        - goals_and_motivations
        - pain_points
        - behaviors
        - demographics
      validation_rules:
        - concrete_demographics
        - specific_goals
        - measurable_behaviors
        - pain_points_detailed
        - personas_differentiated
        
    business_case:
      agent: ba
      minimum_score: 75
      escalation_threshold: 55
      required_sections:
        - problem_statement
        - solution_overview
        - financial_projections
        - roi_analysis
        - competitor_analysis
        - implementation_timeline
      validation_rules:
        - financial_projections_quantified
        - roi_calculated
        - competitors_identified
        - timeline_realistic
        - assumptions_documented
        
    bdd_scenarios:
      agent: ba
      minimum_score: 90
      escalation_threshold: 70
      required_sections:
        - feature_files
        - scenario_coverage
        - step_definitions
        - test_data
      validation_rules:
        - gherkin_syntax_valid
        - scenarios_comprehensive
        - edge_cases_covered
        - test_data_realistic
        - traceability_to_stories
        
    # UX Designer Documents (UX Agent)
    journey_maps:
      agent: ux
      minimum_score: 85
      escalation_threshold: 65
      required_sections:
        - user_journeys
        - touchpoints
        - pain_points
        - opportunities
        - personas_mapped
      validation_rules:
        - journeys_complete
        - touchpoints_detailed
        - emotions_identified
        - opportunities_actionable
        - personas_consistent
        
    wireframes:
      agent: ux
      minimum_score: 85
      escalation_threshold: 65
      required_sections:
        - page_wireframes
        - component_library
        - interaction_flows
        - responsive_considerations
      validation_rules:
        - wireframes_complete
        - components_documented
        - flows_logical
        - accessibility_considered
        - responsive_design_shown
        
    design_system:
      agent: ux
      minimum_score: 90
      escalation_threshold: 70
      required_sections:
        - design_tokens
        - component_specifications
        - usage_guidelines
        - accessibility_standards
      validation_rules:
        - tokens_consistent
        - components_reusable
        - guidelines_clear
        - wcag_compliance
        - brand_alignment
        
    # Solution Architect Documents (Architect Agent)
    architecture_design:
      agent: architect
      minimum_score: 95
      escalation_threshold: 80
      required_sections:
        - system_overview
        - component_diagram
        - data_flow
        - deployment_architecture
        - technology_stack
        - scalability_plan
      validation_rules:
        - c4_diagrams_present
        - components_documented
        - integrations_defined
        - constraints_specified
        - scalability_addressed
        - security_considered
        
    tech_spec:
      agent: architect
      minimum_score: 95
      escalation_threshold: 80
      required_sections:
        - api_specifications
        - database_design
        - integration_patterns
        - performance_requirements
        - security_requirements
      validation_rules:
        - apis_documented_openapi
        - database_normalized
        - performance_quantified
        - security_comprehensive
        - error_handling_defined
        
    deployment_plan:
      agent: architect
      minimum_score: 90
      escalation_threshold: 75
      required_sections:
        - environment_strategy
        - deployment_pipeline
        - monitoring_setup
        - rollback_procedures
      validation_rules:
        - environments_defined
        - pipeline_automated
        - monitoring_comprehensive
        - rollback_tested
        - disaster_recovery_planned
        
    # Development Lead Documents (Dev-Lead Agent)
    implementation_plan:
      agent: dev-lead
      minimum_score: 95
      escalation_threshold: 80
      required_sections:
        - layer_breakdown
        - tdd_approach
        - file_structure
        - definition_of_done
        - architectural_constraints
      validation_rules:
        - layers_sequential
        - tdd_methodology_clear
        - files_specific
        - dod_measurable
        - constraints_architectural
        
    code_review:
      agent: dev-lead
      minimum_score: 95
      escalation_threshold: 80
      required_sections:
        - functionality_review
        - code_quality_check
        - test_coverage_analysis
        - architecture_compliance
        - security_review
      validation_rules:
        - functionality_verified
        - quality_metrics_met
        - coverage_adequate
        - architecture_followed
        - security_validated

  # ====================================================================
  # CODE QUALITY GATES (Implementation)
  # ====================================================================
        
  code:
    
    # Database Layer (TDD Agents)
    database_layer:
      agent: dev-tdd
      minimum_score: 98
      escalation_threshold: 85
      validation_rules:
        - migrations_reversible
        - indexes_present
        - relationships_defined
        - test_coverage_80_plus
        - naming_conventions_followed
        - constraints_proper
        
    # Backend Layer (TDD Agents)
    backend_layer:
      agent: dev-tdd
      minimum_score: 98
      escalation_threshold: 85
      validation_rules:
        - api_documented
        - error_handling_comprehensive
        - business_logic_tested
        - complexity_under_10
        - solid_principles_followed
        - security_implemented
        
    # Configuration Layer (TDD Agents)
    config_layer:
      agent: dev-tdd
      minimum_score: 98
      escalation_threshold: 85
      validation_rules:
        - routes_registered
        - di_configured
        - feature_flags_implemented
        - middleware_appropriate
        - environment_specific
        
    # Frontend Layer (TDD Agents)
    frontend_layer:
      agent: dev-tdd
      minimum_score: 98
      escalation_threshold: 85
      validation_rules:
        - components_tested
        - accessibility_compliant
        - design_system_followed
        - state_management_clear
        - performance_optimized
        - responsive_design

# ====================================================================
# VALIDATION ACTIONS (What happens when quality thresholds are met/missed)
# ====================================================================

validation_actions:
  
  # Quality score meets minimum threshold
  quality_above_minimum:
    actions:
      - allow_workflow_progression
      - log_success_metrics
      - update_quality_dashboard
      - trigger_next_workflow_step
      - notify_agent_success
      
  # Quality score below minimum but above escalation threshold  
  quality_below_minimum:
    actions:
      - block_workflow_progression
      - create_quality_improvement_task
      - notify_agent_owner
      - log_quality_metrics
      - schedule_retry_attempt
    max_attempts: 3
    retry_delay: immediate
    
  # Quality score below escalation threshold
  quality_at_escalation:
    actions:
      - immediate_escalation_trigger
      - notify_orchestrator
      - request_human_review
      - pause_workflow_execution
      - create_escalation_ticket
    escalation_urgency: high
    human_review_required: true

# ====================================================================
# QUALITY IMPROVEMENT WORKFLOWS (How to automatically improve quality)
# ====================================================================

improvement_workflows:
  
  # Document quality improvement process
  document_refinement:
    max_attempts: 3
    improvement_strategies:
      attempt_1:
        - add_missing_sections
        - remove_placeholder_text
        - quantify_vague_statements
        - improve_formatting
      attempt_2:
        - enhance_traceability
        - add_specific_examples
        - improve_clarity
        - validate_references
      attempt_3:
        - comprehensive_rewrite
        - escalate_to_senior_agent
        - request_stakeholder_input
        - consider_scope_reduction
        
  # Code quality improvement process
  code_refinement:
    max_attempts: 2
    improvement_strategies:
      attempt_1:
        - increase_test_coverage
        - reduce_complexity
        - improve_documentation
        - fix_naming_conventions
      attempt_2:
        - architectural_refactor
        - performance_optimization
        - security_hardening
        - escalate_to_architect

# ====================================================================
# QUALITY SCORING WEIGHTS (How quality percentage is calculated)
# ====================================================================

scoring_weights:
  
  # Document quality calculation (100%)
  documents:
    content_completeness: 40    # All required sections present, no placeholders
    specificity_clarity: 30     # Concrete details, measurable criteria, clear language
    traceability: 20           # Proper references to requirements, user stories, architecture
    format_compliance: 10      # Proper structure, markdown formatting, diagrams
    
  # Code quality calculation (100%)
  code:
    functionality: 40          # Meets acceptance criteria, BDD tests pass
    test_coverage: 25         # >80% unit/integration coverage
    code_quality: 25          # Cyclomatic complexity <10, SOLID principles
    documentation: 10         # Clear comments, API docs, README updates

# ====================================================================
# ESCALATION MATRIX (Who gets notified when)
# ====================================================================

escalation_matrix:
  
  # Immediate escalations (system-critical)
  immediate:
    triggers:
      - quality_scoring_engine_failure
      - validation_rules_missing
      - agent_consecutive_failures_3x
      - system_wide_quality_degradation
    notify:
      - orchestrator_agent
      - human_supervisor
      - system_administrator
    response_time: "<5 minutes"
    
  # High priority escalations (workflow-blocking)  
  high_priority:
    triggers:
      - quality_below_escalation_threshold
      - workflow_blocked_over_24h
      - repeated_quality_failures_same_agent
    notify:
      - orchestrator_agent
      - workflow_owner
      - agent_supervisor
    response_time: "<2 hours"
    
  # Medium priority escalations (quality trends)
  medium_priority:
    triggers:
      - average_quality_declining_7_days
      - retry_rate_above_30_percent
      - new_quality_patterns_detected
    notify:
      - orchestrator_agent
      - quality_team
    response_time: "<24 hours"

# ====================================================================
# QUALITY DASHBOARD CONFIGURATION
# ====================================================================

dashboard_config:
  
  # Real-time metrics refresh intervals
  refresh_intervals:
    quality_scores: "30 seconds"
    workflow_status: "1 minute" 
    trend_analysis: "5 minutes"
    escalation_alerts: "real-time"
    
  # Quality thresholds for dashboard alerts
  alert_thresholds:
    system_health_good: ">85%"
    system_health_warning: "70-85%"
    system_health_critical: "<70%"
    
  # Historical data retention
  data_retention:
    quality_scores: "90 days"
    workflow_metrics: "1 year"
    escalation_history: "2 years"
    trend_analysis: "6 months"